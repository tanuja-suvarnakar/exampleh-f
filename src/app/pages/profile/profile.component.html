<!-- src/app/pages/profile/profile.component.html -->
<div class="profile-container">
  
  <!-- Page Header -->
  <header class="page-header">
    <div class="header-content">
      <h1 class="page-title">My Profile</h1>
      <p class="page-subtitle">Manage your personal information and account settings</p>
    </div>
  </header>

  <div class="profile-grid">
    
    <!-- Left Column - User Card -->
    <aside class="profile-sidebar">
      <div class="user-card">
        <div class="user-avatar">
          {{ getInitials() }}
        </div>
        <h2 class="user-name">{{ user?.fullName || 'User' }}</h2>
        <p class="user-email">{{ user?.email }}</p>
        <span class="user-role" [ngClass]="'role-' + getRoleColor(user?.role)">
          {{ getRoleDisplay(user?.role) }}
        </span>
        
        <div class="user-stats">
          <div class="stat">
            <span class="stat-value">{{ user?.createdAt | date:'mediumDate' }}</span>
            <span class="stat-label">Member Since</span>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <button class="action-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          <span>Download Data</span>
        </button>
        <button class="action-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 8v4M12 16h.01"/>
          </svg>
          <span>Help & Support</span>
        </button>
      </div>
    </aside>

    <!-- Right Column - Forms -->
    <main class="profile-main">
      
      <!-- Profile Information Section -->
      <section class="profile-section">
        <div class="section-header">
          <h3 class="section-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="8" r="4"/>
              <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
            </svg>
            Personal Information
          </h3>
          <button 
            class="btn btn-secondary" 
            (click)="toggleEditProfile()"
            *ngIf="!isEditingProfile"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Edit Profile
          </button>
        </div>

        <!-- Success/Error Messages -->
        <div *ngIf="profileSuccess" class="success-message">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          <span>{{ profileSuccess }}</span>
        </div>
        
        <div *ngIf="profileError" class="error-banner">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 8v4M12 16h.01"/>
          </svg>
          <span>{{ profileError }}</span>
        </div>

        <!-- View Mode -->
        <div class="info-grid" *ngIf="!isEditingProfile">
          <div class="info-item">
            <label>Full Name</label>
            <span>{{ user?.fullName || '—' }}</span>
          </div>
          <div class="info-item">
            <label>Email Address</label>
            <span>{{ user?.email || '—' }}</span>
          </div>
          <div class="info-item">
            <label>Phone Number</label>
            <span>{{ user?.phone || 'Not provided' }}</span>
          </div>
          <div class="info-item">
            <label>Bio</label>
            <span>{{ user?.bio || 'No bio added yet' }}</span>
          </div>
        </div>

        <!-- Edit Mode -->
        <form [formGroup]="profileForm" (ngSubmit)="updateProfile()" *ngIf="isEditingProfile">
          <div class="form-grid">
            <div class="form-group">
              <label for="fullName">Full Name <span class="required">*</span></label>
              <input 
                id="fullName" 
                type="text" 
                formControlName="fullName"
                [class.invalid]="pf['fullName'].invalid && pf['fullName'].touched"
              />
              <div *ngIf="pf['fullName'].invalid && pf['fullName'].touched" class="error-text">
                <span *ngIf="pf['fullName'].errors?.['required']">Name is required</span>
                <span *ngIf="pf['fullName'].errors?.['minlength']">Minimum 2 characters</span>
              </div>
            </div>

            <div class="form-group">
              <label for="email">Email Address <span class="required">*</span></label>
              <input 
                id="email" 
                type="email" 
                formControlName="email"
                [class.invalid]="pf['email'].invalid && pf['email'].touched"
              />
              <div *ngIf="pf['email'].invalid && pf['email'].touched" class="error-text">
                <span *ngIf="pf['email'].errors?.['required']">Email is required</span>
                <span *ngIf="pf['email'].errors?.['email']">Invalid email format</span>
              </div>
            </div>

            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input 
                id="phone" 
                type="tel" 
                formControlName="phone"
                placeholder="+1234567890"
              />
            </div>

            <div class="form-group full-width">
              <label for="bio">Bio</label>
              <textarea 
                id="bio" 
                formControlName="bio"
                rows="3"
                placeholder="Tell us about yourself..."
              ></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="toggleEditProfile()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="profileSaving">
              <span *ngIf="profileSaving" class="spinner-small"></span>
              <span>{{ profileSaving ? 'Saving...' : 'Save Changes' }}</span>
            </button>
          </div>
        </form>
      </section>

      <!-- Password Section -->
      <section class="profile-section">
        <div class="section-header">
          <h3 class="section-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0110 0v4"/>
            </svg>
            Security
          </h3>
          <button 
            class="btn btn-secondary" 
            (click)="toggleChangePassword()"
            *ngIf="!isChangingPassword"
          >
            Change Password
          </button>
        </div>

        <!-- Success/Error Messages -->
        <div *ngIf="passwordSuccess" class="success-message">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          <span>{{ passwordSuccess }}</span>
        </div>
        
        <div *ngIf="passwordError" class="error-banner">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 8v4M12 16h.01"/>
          </svg>
          <span>{{ passwordError }}</span>
        </div>

        <!-- View Mode -->
        <div class="security-info" *ngIf="!isChangingPassword">
          <p>Your password was last changed on <strong>Never</strong></p>
          <p class="security-hint">Use a strong password with at least 6 characters including letters and numbers.</p>
        </div>

        <!-- Change Password Form -->
        <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" *ngIf="isChangingPassword">
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="currentPassword">Current Password <span class="required">*</span></label>
              <input 
                id="currentPassword" 
                type="password" 
                formControlName="currentPassword"
                [class.invalid]="pwf['currentPassword'].invalid && pwf['currentPassword'].touched"
              />
              <div *ngIf="pwf['currentPassword'].invalid && pwf['currentPassword'].touched" class="error-text">
                Current password is required
              </div>
            </div>

            <div class="form-group">
              <label for="newPassword">New Password <span class="required">*</span></label>
              <input 
                id="newPassword" 
                type="password" 
                formControlName="newPassword"
                [class.invalid]="pwf['newPassword'].invalid && pwf['newPassword'].touched"
              />
              <div *ngIf="pwf['newPassword'].invalid && pwf['newPassword'].touched" class="error-text">
                <span *ngIf="pwf['newPassword'].errors?.['required']">Password is required</span>
                <span *ngIf="pwf['newPassword'].errors?.['minlength']">Minimum 6 characters</span>
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirm Password <span class="required">*</span></label>
              <input 
                id="confirmPassword" 
                type="password" 
                formControlName="confirmPassword"
                [class.invalid]="pwf['confirmPassword'].invalid && pwf['confirmPassword'].touched"
              />
              <div *ngIf="pwf['confirmPassword'].invalid && pwf['confirmPassword'].touched" class="error-text">
                Please confirm password
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="toggleChangePassword()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="passwordSaving">
              <span *ngIf="passwordSaving" class="spinner-small"></span>
              <span>{{ passwordSaving ? 'Changing...' : 'Change Password' }}</span>
            </button>
          </div>
        </form>
      </section>
    </main>
  </div>
</div>